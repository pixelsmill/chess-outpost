<div class="analyze-content">
  <!-- Interface de chargement PGN -->
  @if (showPgnInput() && !isNavigationMode()) {
  <div class="pgn-input-container">
    <h3>📋 Charger une partie PGN</h3>
    <textarea
      [(ngModel)]="pgnText"
      placeholder="Collez votre PGN ici...&#10;&#10;Exemple:&#10;1. e4 e5 2. Nf3 Nc6 3. Bb5 a6"
      class="pgn-textarea"
      rows="8"
    >
    </textarea>
    <div class="pgn-actions">
      <button (click)="loadPgn()" class="load-btn">✅ Charger la partie</button>
      <button routerLink="/" class="cancel-btn">❌ Retour à l'accueil</button>
    </div>
  </div>
  }

  <!-- Mode analyse avec nouveau système -->
  @if (isNavigationMode()) {

  <!-- Boutons de sélection du background -->
  <div class="background-selector">
    <button
      class="bg-btn"
      [class.active]="selectedBackground() === 'classic'"
      (click)="setBackground('classic')"
    >
      Échiquier Classique
    </button>
    <button
      class="bg-btn"
      [class.active]="selectedBackground() === 'heatmap'"
      (click)="setBackground('heatmap')"
    >
      Contrôle Territorial
    </button>
    <button
      class="bg-btn"
      [class.active]="selectedBackground() === 'topographic'"
      (click)="setBackground('topographic')"
    >
      Vue Topographique
    </button>
  </div>

  <!-- Échiquier unique avec background dynamique -->
  <div class="board-container">
    <app-board-wrapper>
      <!-- Background classique -->
      @if (selectedBackground() === 'classic') {
      <app-classic-board [position]="currentPosition()"></app-classic-board>
      }

      <!-- Background heatmap -->
      @if (selectedBackground() === 'heatmap') {
      <app-heatmap-board [position]="currentPosition()"></app-heatmap-board>
      }

      <!-- Background topographique -->
      @if (selectedBackground() === 'topographic') {
      <app-topographic-board
        [position]="currentPosition()"
      ></app-topographic-board>
      }

      <!-- Grille de pièces par-dessus (DISABLED en mode analyse) -->
      <app-echiquier
        [externalPosition]="currentPosition()"
        [disableClicks]="true"
        (positionChange)="onPositionChange($event)"
      ></app-echiquier>
    </app-board-wrapper>
  </div>

  <!-- Contrôles de navigation en bas -->
  <div class="navigation-controls">
    <h3>🎮 Navigation dans la partie</h3>
    <div class="move-info">
      {{ getCurrentMoveDisplay() }}
    </div>
    <div class="nav-buttons">
      <button
        (click)="goToStart()"
        [disabled]="!canGoBack"
        class="nav-btn-control"
        title="Aller au début"
      >
        ⏮️
      </button>
      <button
        (click)="goToPrevious()"
        [disabled]="!canGoBack"
        class="nav-btn-control"
        title="Coup précédent"
      >
        ⏪
      </button>
      <button
        (click)="goToNext()"
        [disabled]="!canGoForward"
        class="nav-btn-control"
        title="Coup suivant"
      >
        ⏩
      </button>
      <button
        (click)="goToEnd()"
        [disabled]="!canGoForward"
        class="nav-btn-control"
        title="Aller à la fin"
      >
        ⏭️
      </button>
    </div>
  </div>
  }
</div>
